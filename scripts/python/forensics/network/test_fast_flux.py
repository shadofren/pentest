from kamene.all import rdpcap
from kamene.layers.dns import DNSRR
from collections import defaultdict

dns_records = defaultdict(set)


def handle_pkt(pkt):
    if pkt.haslayer(DNSRR):
        rrname = pkt.getlayer(DNSRR).rrname
        rdata = pkt.getlayer(DNSRR).rdata
        dns_records[rrname].add(rdata)


if __name__ == '__main__':
    pkts = rdpcap('fast_flux.pcap')
    for _pkt in pkts:
        handle_pkt(_pkt)

    for item in dns_records:
        print(
            f"[+] {item.decode('utf-8')} has {str(len(dns_records[item]))} unique IPs.")

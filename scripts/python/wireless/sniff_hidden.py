#!/usr/bin/env python
# Wireless AP can hide it's BSSID by a blank value in BSSID field
# We just need to get all the APs that have blank BSSID
# The probe request will contains the SSID name

from kamene.all import sniff
from kamene.layers.dot11 import Dot11, Dot11ProbeReq, Dot11Beacon


def sniff_dot11(pkt):
    if pkt.haslayer(Dot11ProbeReq):
        addr2 = pkt.getlayer(Dot11).addr2
        if (addr2 in hidden_nets) & (addr2 not in unhidden_nets):
            net_name = pkt.getlayer(Dot11ProbeReq).info
            print(f'[+] De-cloaked Hidden SSID: {net_name} for MAC: {addr2}')
            unhidden_nets.add(addr2)

    if pkt.haslayer(Dot11Beacon):
        if pkt.getlayer(Dot11Beacon).info == '':
            addr2 = pkt.getlayer(Dot11).addr2
            if addr2 not in hidden_nets:
                print(f'[-] Detected Hidden SSID with MAC: {addr2}')
                hidden_nets.add(addr2)


if __name__ == '__main__':
    hidden_nets = set()
    unhidden_nets = set()
    sniff(iface='mon0', prn=sniff_dot11)
